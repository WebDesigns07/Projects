!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).YuyanMonitor=t()}(this,(function(){"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){asyncGeneratorStep(i,n,o,a,s,"next",e)}function s(e){asyncGeneratorStep(i,n,o,a,s,"throw",e)}a(void 0)}))}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;t.length>r;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableRest()}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);t>r;r++)n[r]=e[r];return n}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _typeof$1(e){return(_typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck$1(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(e,t){for(var r=0;t.length>r;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$1(e,t,r){return t&&_defineProperties$1(e.prototype,t),r&&_defineProperties$1(e,r),e}function _slicedToArray(e,t){return _arrayWithHoles$1(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray$1(e,t)||_nonIterableRest$1()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray$1(e)||_unsupportedIterableToArray$1(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray$1(e)}function _arrayWithHoles$1(e){if(Array.isArray(e))return e}function _iterableToArray$1(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}}function _unsupportedIterableToArray$1(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$1(e,t):void 0}}function _arrayLikeToArray$1(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);t>r;r++)n[r]=e[r];return n}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest$1(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var checkEnv=function(e){return function(){if(!e||!e.navigator||!e.navigator.userAgent)return"";var t=e.navigator.userAgent,r="";return!!t.match(/iphone|ipad|iPod/gi)&&(r="iOS"),!!t.match(/android/gi)&&(r="Android"),!!t.match(/Firefox/gi)&&(r="Firefox"),!!t.match(/Chrome/gi)&&(r="Chrome"),!t.match(/Chrome/gi)&&!!t.match(/Safari/gi)&&(r="Safari"),!!t.match(/Opera/gi)&&(r="Opera"),!!t.match(/MSIE/gi)&&(r="IE"),r}}(void 0);function checkAndriodSpecial(){return!0}var generateHandler=function(e){switch(e){case"iOS":return{filter:function(e){return 0>e.indexOf("[native code]")&&e.indexOf("@")>=0}};case"Android":return{filter:function(e,t){return t&&0>e.indexOf("nonymous")&&checkAndriodSpecial()}};default:return{filter:function(){return!0}}}};function safeAdd(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function bitRotateLeft(e,t){return e<<t|e>>>32-t}function md5cmn(e,t,r,n,o,i){return safeAdd(bitRotateLeft(safeAdd(safeAdd(t,e),safeAdd(n,i)),o),r)}function md5ff(e,t,r,n,o,i,a){return md5cmn(t&r|~t&n,e,t,o,i,a)}function md5gg(e,t,r,n,o,i,a){return md5cmn(t&n|r&~n,e,t,o,i,a)}function md5hh(e,t,r,n,o,i,a){return md5cmn(t^r^n,e,t,o,i,a)}function md5ii(e,t,r,n,o,i,a){return md5cmn(r^(t|~n),e,t,o,i,a)}function binlMD5(e,t){var r,n,o,i,a;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var s=1732584193,c=-271733879,u=-1732584194,f=271733878;for(r=0;e.length>r;r+=16)n=s,o=c,i=u,a=f,s=md5ff(s,c,u,f,e[r],7,-680876936),f=md5ff(f,s,c,u,e[r+1],12,-389564586),u=md5ff(u,f,s,c,e[r+2],17,606105819),c=md5ff(c,u,f,s,e[r+3],22,-1044525330),s=md5ff(s,c,u,f,e[r+4],7,-176418897),f=md5ff(f,s,c,u,e[r+5],12,1200080426),u=md5ff(u,f,s,c,e[r+6],17,-1473231341),c=md5ff(c,u,f,s,e[r+7],22,-45705983),s=md5ff(s,c,u,f,e[r+8],7,1770035416),f=md5ff(f,s,c,u,e[r+9],12,-1958414417),u=md5ff(u,f,s,c,e[r+10],17,-42063),c=md5ff(c,u,f,s,e[r+11],22,-1990404162),s=md5ff(s,c,u,f,e[r+12],7,1804603682),f=md5ff(f,s,c,u,e[r+13],12,-40341101),u=md5ff(u,f,s,c,e[r+14],17,-1502002290),s=md5gg(s,c=md5ff(c,u,f,s,e[r+15],22,1236535329),u,f,e[r+1],5,-165796510),f=md5gg(f,s,c,u,e[r+6],9,-1069501632),u=md5gg(u,f,s,c,e[r+11],14,643717713),c=md5gg(c,u,f,s,e[r],20,-373897302),s=md5gg(s,c,u,f,e[r+5],5,-701558691),f=md5gg(f,s,c,u,e[r+10],9,38016083),u=md5gg(u,f,s,c,e[r+15],14,-660478335),c=md5gg(c,u,f,s,e[r+4],20,-405537848),s=md5gg(s,c,u,f,e[r+9],5,568446438),f=md5gg(f,s,c,u,e[r+14],9,-1019803690),u=md5gg(u,f,s,c,e[r+3],14,-187363961),c=md5gg(c,u,f,s,e[r+8],20,1163531501),s=md5gg(s,c,u,f,e[r+13],5,-1444681467),f=md5gg(f,s,c,u,e[r+2],9,-51403784),u=md5gg(u,f,s,c,e[r+7],14,1735328473),s=md5hh(s,c=md5gg(c,u,f,s,e[r+12],20,-1926607734),u,f,e[r+5],4,-378558),f=md5hh(f,s,c,u,e[r+8],11,-2022574463),u=md5hh(u,f,s,c,e[r+11],16,1839030562),c=md5hh(c,u,f,s,e[r+14],23,-35309556),s=md5hh(s,c,u,f,e[r+1],4,-1530992060),f=md5hh(f,s,c,u,e[r+4],11,1272893353),u=md5hh(u,f,s,c,e[r+7],16,-155497632),c=md5hh(c,u,f,s,e[r+10],23,-1094730640),s=md5hh(s,c,u,f,e[r+13],4,681279174),f=md5hh(f,s,c,u,e[r],11,-358537222),u=md5hh(u,f,s,c,e[r+3],16,-722521979),c=md5hh(c,u,f,s,e[r+6],23,76029189),s=md5hh(s,c,u,f,e[r+9],4,-640364487),f=md5hh(f,s,c,u,e[r+12],11,-421815835),u=md5hh(u,f,s,c,e[r+15],16,530742520),s=md5ii(s,c=md5hh(c,u,f,s,e[r+2],23,-995338651),u,f,e[r],6,-198630844),f=md5ii(f,s,c,u,e[r+7],10,1126891415),u=md5ii(u,f,s,c,e[r+14],15,-1416354905),c=md5ii(c,u,f,s,e[r+5],21,-57434055),s=md5ii(s,c,u,f,e[r+12],6,1700485571),f=md5ii(f,s,c,u,e[r+3],10,-1894986606),u=md5ii(u,f,s,c,e[r+10],15,-1051523),c=md5ii(c,u,f,s,e[r+1],21,-2054922799),s=md5ii(s,c,u,f,e[r+8],6,1873313359),f=md5ii(f,s,c,u,e[r+15],10,-30611744),u=md5ii(u,f,s,c,e[r+6],15,-1560198380),c=md5ii(c,u,f,s,e[r+13],21,1309151649),s=md5ii(s,c,u,f,e[r+4],6,-145523070),f=md5ii(f,s,c,u,e[r+11],10,-1120210379),u=md5ii(u,f,s,c,e[r+2],15,718787259),c=md5ii(c,u,f,s,e[r+9],21,-343485551),s=safeAdd(s,n),c=safeAdd(c,o),u=safeAdd(u,i),f=safeAdd(f,a);return[s,c,u,f]}function binl2rstr(e){var t,r="",n=32*e.length;for(t=0;n>t;t+=8)r+=String.fromCharCode(e[t>>5]>>>t%32&255);return r}function rstr2binl(e){var t,r=[];for(r[(e.length>>2)-1]=void 0,t=0;r.length>t;t+=1)r[t]=0;var n=8*e.length;for(t=0;n>t;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}function rstrMD5(e){return binl2rstr(binlMD5(rstr2binl(e),8*e.length))}function rstrHMACMD5(e,t){var r,n,o=rstr2binl(e),i=[],a=[];for(i[15]=a[15]=void 0,o.length>16&&(o=binlMD5(o,8*e.length)),r=0;16>r;r+=1)i[r]=909522486^o[r],a[r]=1549556828^o[r];return n=binlMD5(i.concat(rstr2binl(t)),512+8*t.length),binl2rstr(binlMD5(a.concat(n),640))}function rstr2hex(e){var t,r,n="";for(r=0;e.length>r;r+=1)t=e.charCodeAt(r),n+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return n}function str2rstrUTF8(e){return unescape(encodeURIComponent(e))}function rawMD5(e){return rstrMD5(str2rstrUTF8(e))}function hexMD5(e){return rstr2hex(rawMD5(e))}function rawHMACMD5(e,t){return rstrHMACMD5(str2rstrUTF8(e),str2rstrUTF8(t))}function hexHMACMD5(e,t){return rstr2hex(rawHMACMD5(e,t))}function md5(e,t,r){return t?r?rawHMACMD5(t,e):hexHMACMD5(t,e):r?rawMD5(e):hexMD5(e)}var ErrorStack=function(){function e(t){_classCallCheck$1(this,e),this.env=t||checkEnv(),this.stackFilter=generateHandler(this.env).filter}return _createClass$1(e,[{key:"makeReg",value:function(){switch(this.env){case"iOS":return/(?:\s*)\w+(?=@)|(?:@).*?(?=:\d*:)|(?::)\d*(?=:)|(?::)\d*$/g;default:return null}}},{key:"stackFormatter",value:function(e){var t=e.message,r=[],n="Android"===this.env,o="iOS"===this.env,i=e.stack.split("\n").filter(this.stackFilter);i.shift();var a=i.join("\n"),s=this.makeReg();return s?i.map((function(e){var t=e.match(s);if(t){var i=_slicedToArray(t,4),a=i[0],c=void 0===a?"":a,u=i[1],f=void 0===u?"":u,l=i[2],d=void 0===l?"":l,p=i[3],h=void 0===p?"":p,m=n?c.split(".").reverse()[0]:c,g=o?1:0;r.push("at ".concat(m," (").concat(f.substr(g),":").concat(d.substr(g),":").concat(h.substr(g),")"))}else r.push(e);return null})):r=i,{hash:this.encryptStack(t,r),message:t,stackList:r,stackStr:a}}},{key:"encryptStack",value:function(e,t){var r=[].concat(_toConsumableArray(t.slice(0,6)),_toConsumableArray(t.slice(7,8)),_toConsumableArray(t.slice(9,10)),_toConsumableArray(t.slice(11,12)),_toConsumableArray(t.slice(13,14))).join(";");return md5("".concat(e,":").concat(r))}}]),e}(),STACK_LENGTH_LIMIT=20,ChromeREGEX=/^\s*at .*? ?\(((?:file|https?|blob|chrome-extension|native|eval|<anonymous>).*?)(?::\d+)?(?::\d+)?\)?\s*$/i,GeckoREGEX=/^\s*.*?(?:\(.*?\))?(?:^|@)((?:file|https?|blob|chrome|resource|\[native).*?)(?::\d+)?(?::\d+)?\s*$/i,WinJSREGEX=/^\s*at (?:(?:\[object object\])?.+ )?\(?((?:file|ms-appx|https?|blob):.*?):\d+(?::\d+)?\)?\s*$/i;function parseStack(e){for(var t=e.slice(0,STACK_LENGTH_LIMIT),r=["",""],n={},o=1,i=0;t.length>i;i+=1){var a=ChromeREGEX,s=(t[i]||"").match(a);if(null===s&&(s=(t[i]||"").match(a=GeckoREGEX)),null===s&&(s=(t[i]||"").match(a=WinJSREGEX)),null!==s){var c=s[1],u=n[c];void 0===u&&(n[c]="#".concat(o,"#"),o+=1,u=n[c]),t[i]=t[i].replace(c,u)}}t.length>0&&(r[1]=t.map((function(e){return e.trim()})).join(""));var f="";for(var l in n)n.hasOwnProperty(l)&&(f+="".concat(l,"@").concat(n[l],";"));return f=f.replace(/;$/,""),r[0]=f,r.join("").replace(/\^/g,"").replace(/=/g,"").replace(/,/g,"")}function unParseStack(e){var t=e&&e.split("")||[];if(!t[0]||!t[1])return e;for(var r={},n=t[0].split(";"),o=0;n.length>o;o+=1){var i=n[o]&&n[o].split("@#");r["#".concat(i[1])]=i[0]}return t[1].replace(/#[0-9]+#/g,(function(e){return r[e]||""})).replace(/\u0004/g,"^").replace(/\u0005/g,"=").replace(/\u0006/g,",").split("")}"undefined"==typeof process||_typeof$1(process);var helper={compressStack:function(e){return parseStack(e)},uncompressStack:function(e){return unParseStack(e)}},compressStack=helper.compressStack;function _typeof$2(e){return(_typeof$2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck$2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$2(e,t){for(var r=0;t.length>r;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$2(e,t,r){return t&&_defineProperties$2(e.prototype,t),r&&_defineProperties$2(e,r),e}function _defineProperty$1(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ownKeys$1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$1(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(r),!0).forEach((function(t){_defineProperty$1(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$1(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _toConsumableArray$1(e){return _arrayWithoutHoles$1(e)||_iterableToArray$2(e)||_unsupportedIterableToArray$2(e)||_nonIterableSpread$1()}function _arrayWithoutHoles$1(e){if(Array.isArray(e))return _arrayLikeToArray$2(e)}function _iterableToArray$2(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _unsupportedIterableToArray$2(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$2(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$2(e,t):void 0}}function _arrayLikeToArray$2(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);t>r;r++)n[r]=e[r];return n}function _nonIterableSpread$1(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=_unsupportedIterableToArray$2(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return e.length>n?{done:!1,value:e[n++]}:{done:!0}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function allFieldsReady(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!t.length)return!0;var n,o=_createForOfIteratorHelper(t);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(null==e[i])return r&&r('Field "'.concat(i,'" is required. Log cached.')),!1}}catch(e){o.e(e)}finally{o.f()}return!0}function shallowMerge(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}function objectAssign(e,t){if(!t||"object"!==_typeof$2(t))return e;var r=e||{};for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&(r[n]=t[n]);return r}function getProperty(e,t){for(var r=t.split("."),n=0;r.length-1>n;n++)if("object"!==_typeof$2(e=e[r[n]])||!e||Array.isArray(e))return"";return e[r.pop()]}function setProperty(e,t,r){for(var n=t.split("."),o=0;n.length-1>o;o++){if("object"!==_typeof$2(e[n[o]])&&void 0!==e[n[o]])return;if(Array.isArray(e[n[o]]))return;e[n[o]]||(e[n[o]]={}),e=e[n[o]]}e[n.pop()]=r}var OptionsDefaulter=function(){function e(){_classCallCheck$2(this,e),this.defaults={},this.configs={}}return _createClass$2(e,[{key:"set",value:function(e,t,r){void 0!==r?(this.defaults[e]=r,this.configs[e]=t):(this.defaults[e]=t,delete this.configs[e])}},{key:"process",value:function(e){var t;for(var r in e=objectAssign({},e),this.defaults)if(this.defaults.hasOwnProperty(r))switch(this.configs[r]){case"call":setProperty(e,r,this.defaults[r].call(this,getProperty(e,r),e));break;case"make":void 0===getProperty(e,r)&&setProperty(e,r,this.defaults[r].call(this,e));break;case"append":var n=getProperty(e,r);Array.isArray(n)||(n=[]),(t=n).push.apply(t,_toConsumableArray$1(this.defaults[r])),setProperty(e,r,n);break;default:void 0===getProperty(e,r)&&setProperty(e,r,this.defaults[r])}return e}}]),e}();function nodeListToArray(e){var t,r;try{return t=[].slice.call(e)}catch(o){t=[],r=e.length;for(var n=0;r>n;n++)t.push(e[n]);return t}}function getAttr(e,t){return e&&e.getAttribute&&e.getAttribute(t)||""}var warnCache={},defaulterSingleton;function warnDeprecated(e,t){console&&console.warn&&!warnCache[e]&&(warnCache[e]=1,console.warn("配置项 [".concat(e,"] 已不推荐使用。请使用 [").concat(t,"]。")))}function getGlobal(){return eval?(0,eval)("this"):global||window}function getOptionsDefaulter(){return defaulterSingleton||(defaulterSingleton=createOptionsDefaulter()),defaulterSingleton}var getMetaInfo=function(e){return function(t){var r;if(!(null==e||null===(r=e.document)||void 0===r?void 0:r.querySelectorAll))return"";for(var n=nodeListToArray(document.querySelectorAll("meta")),o=0;n.length>o;o++){var i=n[o];if(getAttr(i,"name")===t)return getAttr(i,"content")}return null}}(getGlobal()),metaMap={_appId:"bm_app_id",yuyanId:"yuyan_id",sprintId:"bm_sprint_id"};function getMetaOptions(){var e={};for(var t in metaMap)if(metaMap.hasOwnProperty(t)){var r=getMetaInfo(metaMap[t]);r&&(e[t]=r)}return e}function createOptionsDefaulter(){var e=new OptionsDefaulter,t=getMetaOptions();return e.set("bmAppid","call",(function(e,r){return e?(warnDeprecated("bmAppid","_appId"),e):r.appid?(warnDeprecated("appid","_appId"),r.appid):r._appId||t._appId})),e.set("yuyanId","call",(function(e){return e||t.yuyanId})),e.set("userId","call",(function(e,t){return t.roleId?(warnDeprecated("roleId","userId"),t.roleId):e})),e.set("disableInterface","call",(function(e){return e||!1})),e.set("oncePerSession","call",(function(e){return e||!1})),e.set("autoCapture","call",(function(e,t){return!t.hasOwnProperty("autoCapture")||!!t.autoCapture})),e.set("defaults","call",(function(e){return objectAssign({},e)})),e.set("sprintId","call",(function(e){return e||t.sprintId})),e.set("requiredFields","call",(function(e){return Array.isArray(e)?e:"string"==typeof e?[e]:[]})),e.set("eventId","call",(function(e,t){return"PC"===t.appType?"102022":"102023"})),e.set("beforeLog","call",(function(e){if("function"==typeof e)return e})),e.set("callBridge","call",(function(e){if("function"==typeof e)return e})),e.set("plugins","call",(function(e){return Array.isArray(e)?e:["performance","buc"]})),e}var ErrorCodeEnums={JS:1,REQUEST:2,PROMISEREJECTION:3,ASSETS:4},enums=Object.freeze({__proto__:null,ErrorCodeEnums:ErrorCodeEnums}),es=new ErrorStack;function logError(e,t,r){var n=r.log,o=r._warn,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{var a=(null==i?void 0:i.code)||ErrorCodeEnums.JS,s="";if(e&&e.stack){var c=es.stackFormatter(e),u=c.hash,f=c.stackList;s=u,u&&f&&f.length&&t(u).then((function(e){e||n(_objectSpread2$1(_objectSpread2$1({},i),{},{code:ErrorCodeEnums.JS,s1:u,s2:compressStack(f),s3:1}))})).catch((function(e){o("hash检测失败",e)})),n(_objectSpread2$1({code:a,msg:e.message,s10:s},i))}}catch(e){o("异常上报失败:",e)}}var checkApp=function(e){var t={},r=e.match(/AliApp\S+\b\)/gi);return t.is=!!/(T-UA)|(TBIOS)|(WindVane)|(AliApp)/i.test(e),t.name=r?r[0].match(/\(\w+\-*\w*/)[0].split("(")[1]:"",t.version=r?r[0].match(/(\d+\.*)+/gi)[0]:"",t},checkApp_1=checkApp,encodeValue=function(e){return encodeURIComponent(e).replace(/'/g,"%27")};function objToStr(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"^",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=[];if(e instanceof Array)o=e;else if(e instanceof Object){var i=n?encodeValue:function(e){return e};for(t in e)if(e.hasOwnProperty(t)){var a=i(e[t]);o.push("".concat(t,"=").concat(a))}}return o.join(r)}function getTime(){var e=new Date,t=function(e){return 10>e?"0".concat(e):"".concat(e)};return"".concat(e.getFullYear(),"-").concat(t(e.getMonth()+1),"-").concat(t(e.getDate())," ").concat(t(e.getHours()),":").concat(t(e.getMinutes()),":").concat(t(e.getSeconds()),":").concat(e.getMilliseconds())}function parseItem(e){if(!e||"object"!==_typeof(e))return[];var t=e.eventId,r=e.userId,n=e.ua,o=e.param4,i=["D-AE",getTime(),"","","2","","",r,"1000",t,"H5behavior","2","","","","","","","","","","","","","","","","","",n,"","","","","",""];return i.push(objToStr(o,"^",!0)),i}function objectAssign$1(e,t){var r=e||{};if(!t||"object"!==_typeof(t))return r;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&(r[n]=t[n]);return r}function checkIsAlipay(e){var t=e&&e.userAgent;if(!t)return!1;var r=checkApp_1(t);return["AP","AF","AFW","BK","AM","APHK","KB"].indexOf(r.name)>=0}function applyMixins(e,t){t.forEach((function(t){Object.getOwnPropertyNames(t.prototype).forEach((function(r){"constructor"!==r&&(e.prototype[r]=t.prototype[r])}))}))}function addEvent(e,t,r){var n=t||window.document;n.addEventListener?n.addEventListener(e,r,!0):n.attachEvent?n.attachEvent("on".concat(e),r):n[e]=r}function removeEvent(e,t,r){var n=t||window.document;n.removeEventListener?n.removeEventListener(e,r,!0):n.detachEvent?n.detachEvent("on".concat(e),r):n[e]=r}function generateIdentifier(e){return[e.code,e.uid,e.page,e.msg||""].join("_")}function load(e){"interactive"===document.readyState||"complete"===document.readyState?e():addEvent("DOMContentLoaded",document,e)}function getAttr$1(e,t){return e&&e.getAttribute&&e.getAttribute(t)||""}function nodeListToArray$1(e){var t,r;try{return t=[].slice.call(e)}catch(o){t=[],r=e.length;for(var n=0;r>n;n++)t.push(e[n]);return t}}function getXPath(e,t){var r=e.id?"".concat(e.id):"",n=e.className?"".concat(e.className):"",o=e.tagName.toLowerCase(),i=r||n,a=[];r&&a.push('[@id="'.concat(r,'"]')),n&&a.push('[@class="'.concat(n,'"]'));var s="".concat(o).concat(i?a.join(""):"");return e.parentNode&&e.parentNode.tagName&&t-1!=0?"".concat(getXPath(e.parentNode,t-1),">").concat(s):s}function getResourceErrorSrc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.src||e.href;return"img"===e.tagName.toLowerCase()&&0===t.indexOf("data:")&&(t=t.split(",")[0]),t}var spmDataKey="data-aspm";function getMetaSpm(e){for(var t,r,n,o,i=nodeListToArray$1(e||document.getElementsByTagName("meta")),a=i.length,s=0;a>s;s++)if(r=getAttr$1(t=i[s],"name"),n=getAttr$1(t,"content"),r===spmDataKey&&n){o=n;break}var c={};return o&&(c.spmAPos=o),c}function getSpmBPos(){return getAttr$1(document.body,spmDataKey)}var win=window;function interfaceRegister(e){var t=!1;if("XMLHttpRequest"in win){var r=win.XMLHttpRequest.prototype,n=r.open;r.open=function(e,t){this.__interfaceMonitor__={method:e,url:t||"",status_code:null};for(var r=Array(arguments.length),o=0;r.length>o;++o)r[o]=arguments[o];n.apply(this,r)};var o=r.send;r.send=function(r){var n=this;function i(){if(n.__interfaceMonitor__&&4===n.readyState)try{var o=n.__interfaceMonitor__.url;if(0===n.status)return;var i=o.split("?")[0],a=o.split("?")[1]||"",s="string"==typeof r?r:JSON.stringify(r),c=n.response+"";c.length>2048&&(c="[too large]");if(200>n.status||n.status>299||t){if(i===e.server)return void e._warn("上报异常",s);e.logRequestError({type:"http",status:n.status,url:i,method:n.__interfaceMonitor__.method,query:a,data:s,response:c,traceId:e.traceId||""})}}catch(t){e._warn("接口异常上报失败:",t)}}if("onreadystatechange"in n&&"function"==typeof n.onreadystatechange){var a=n.onreadystatechange;n.onreadystatechange=function(){for(var e=Array(arguments.length),t=0;e.length>t;++t)e[t]=arguments[t];i.apply(this,e),a.apply(this,e)}}else n.onreadystatechange=i;for(var s=Array(arguments.length),c=0;s.length>c;++c)s[c]=arguments[c];return o.apply(this,arguments)}}if("fetch"in win){var i=win.fetch;win.fetch=function(){for(var r=Array(arguments.length),n=0;r.length>n;++n)r[n]=arguments[n];var o="GET";return r[1]&&r[1].method&&(o=r[1].method.toUpperCase()),i.apply(this,r).then((function(n){return new Promise((function(i){try{var a=r[0],s=a.split("?")[0],c=a.split("?")[1]||"",u=r[1]&&r[1].body||"",f="string"==typeof u?u:JSON.stringify(u);n.clone().text().then((function(r){n.ok&&!t||e.logRequestError({type:"http",status:n.status,url:s,method:o,query:c,data:f,response:(r||"").length>2048?"[too large]":r,traceId:e.traceId||""})})).then((function(){i(n)}),(function(){i(n)}))}catch(e){i(n)}}))}))}}}var version="2.0.26",spliter="",doc=document,docEl=doc.documentElement,LastAction=function(){function e(){var t=this;_classCallCheck(this,e),this.lastAction="0".concat(getTime(),""),this.setLastActionTimer=!1,addEvent("scroll",document,(function(e){t.setLastActionTimer||(t.setLastActionTimer=!0,setTimeout((function(){t.setLastActionTimer=!1}),300),t.setLastAction(e))})),addEvent("click",document,(function(e){t.setLastAction(e)}))}return _createClass(e,[{key:"setLastAction",value:function(e){try{var t=[],r="click"===e.type;t.push(r?1:2);var n=r?"".concat(getXPath(e.target,5)):"";t.push(n),t.push(getTime());var o=r?"".concat(e.x,"x").concat(e.y):"".concat(docEl.scrollLeft+doc.body.scrollLeft,"x").concat(docEl.scrollTop+doc.body.scrollTop);t.push(o);var i=e.target&&e.target.innerText,a=i?"".concat(i.slice(0,8)):"";t.push(a),this.lastAction=t.join(spliter)}catch(e){}}},{key:"get",value:function(){return this.lastAction}}]),e}(),serverUrl="https://mdap.alipay.com/loggw/dwcookieLogGet.do",NAVIGATION_KEYS=["connectEnd","connectStart","decodedBodySize","domComplete","domContentLoadedEventEnd","domContentLoadedEventStart","domInteractive","domainLookupEnd","domainLookupStart","duration","encodedBodySize","fetchStart","loadEventEnd","loadEventStart","redirectCount","redirectEnd","redirectStart","requestStart","responseEnd","responseStart","secureConnectionStart","transferSize","type","unloadEventEnd","unloadEventStart","workerStart","firstPaint","firstContentfulPaint","firstMeaningfulPaint"],ErrorCodeEnums$1=enums.ErrorCodeEnums,doc$1=document,docEl$1=doc$1.documentElement,startTime=(new Date).getTime(),Base=function(){function e(t){_classCallCheck(this,e),this.server=serverUrl,this.userConfig={},this.defaults={},this.cOfflineVer="",this.cAppId="",this.cUserId="",this.trackedLogs=[],this.requiredFields=[],this.isErrorHandler=!1,this.enabledPlugins=[];var r=getOptionsDefaulter().process(t);this.userConfig=r,this.eventId="102022",this.bmAppid=r.bmAppid,this.debug=r.debug||!1,this.autoCapture=r.autoCapture,this.disableInterface=r.disableInterface,this.lastActionComp=new LastAction,this.oncePerSession=r.oncePerSession,this.beforeLog=r.beforeLog,this.defaults=r.defaults||{},this.requiredFields=r.requiredFields||[],this.enabledPlugins=r.plugins}return _createClass(e,[{key:"handleErrorEvent",value:function(e,t){try{var r=e.target||e.srcElement;if(!r)return;if("unhandledrejection"===e.type){var n=e.reason||{};if(n.message&&n.stack)this.logError(n,{code:ErrorCodeEnums$1.PROMISEREJECTION});else{var o=n.message||("string"==typeof n?n:JSON.stringify(n));t({code:ErrorCodeEnums$1.PROMISEREJECTION,msg:o})}return}if(r instanceof HTMLElement){var i=getResourceErrorSrc(r),a=r.tagName.toLowerCase(),s=r.alt,c=void 0===s?"":s;return void t({code:ErrorCodeEnums$1.ASSETS,msg:i||"",s1:a,s2:getXPath(r,5),s3:c})}if(e.error&&e.error.stack)return void this.logError(e.error);t({code:ErrorCodeEnums$1.JS,msg:e.message,s3:0})}catch(e){this._warn("handleErrorOptions failed",e)}}},{key:"handlePreCapture",value:function(){var e=this,t=window.g_monitor;if(t){var r=t.listener,n=void 0===r?{}:r,o=t.events,i=void 0===o?[]:o;for(var a in n)n.hasOwnProperty(a)&&(removeEvent(a,window,n[a]),delete n[a]);for(var s=0;i.length>s;s++)this.handleErrorEvent(i[s],(function(t){e.log(t)}));t.events=[]}}},{key:"register",value:function(){var e=this;if(this.autoCapture)try{if(!doc$1)return this._warn("当前为非 web 环境，不支持报错监听与插件使用"),this;if(this.isErrorHandler)return void this._warn("错误事件已监听");var t=function(t){e.handleErrorEvent(t,(function(t){e.log(t)}))};addEvent("error",window,t),addEvent("unhandledrejection",window,t),this.isErrorHandler=!0}catch(e){this._warn("异常监听事件注册失败",e)}else this._warn("已通过 autoCapture 禁用异常捕获")}},{key:"isBridgeReport",value:function(e){return window.AlipayJSBridge&&(Number(e)>10||1>Number(e))}},{key:"getNetwork",value:function(){var e=navigator;return e&&e.connection&&e.connection.effectiveType?e.connection.effectiveType:""}},{key:"_warn",value:function(){var e=window;if("object"===_typeof(e)&&e.console&&"function"==typeof e.console.warn&&this.debug){for(var t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];var o=Array.prototype.slice.call(r);e.console.warn.call(null,"[Monitor Debug]".concat(o[0]),o.slice(1))}}},{key:"parseParam4",value:function(e){if(!e||"object"!==_typeof(e))return null;var t=_objectSpread2(_objectSpread2({},this.defaults),e);(e.bmAppid||this.bmAppid)&&(t.bm_appid=e.bmAppid||this.bmAppid),this.userConfig.sprintId&&(t.bm_sid=this.userConfig.sprintId),this.userConfig.env&&(t.env=this.userConfig.env),this.userConfig.yuyanId&&(t.yuyan_id=this.userConfig.yuyanId),t.monitor_ver="websdk:".concat(version),t.title=t.title||document.title,t.dom_cnt=document.getElementsByTagName("*").length,t.delay=(new Date).getTime()-startTime,t.scroll_top=docEl$1.scrollTop+doc$1.body.scrollTop,t.content_height=Math.max(docEl$1.clientHeight,docEl$1.offsetHeight,docEl$1.scrollHeight),t.last_action=this.lastActionComp.get(),t.network=this.getNetwork();var r=this.userConfig.spmAPos&&this.userConfig.spmBPos?"".concat(this.userConfig.spmAPos,".").concat(this.userConfig.spmBPos):"";if(r&&(t.spmId=r),t.fullURL=t.fullURL||location.href,this.cOfflineVer&&(t.c_offline_ver=this.cOfflineVer),this.cAppId&&(t.c_app_id=this.cAppId),"object"===_typeof(t)){var n=t;for(var o in n)if(n.hasOwnProperty(o)&&"string"==typeof n[o]){var i=n[o].replace(/\s+/g," ");n[o]="fullURL"===o&&i.length>300?i.slice(0,300):i}}return t}},{key:"sendData",value:function(e){var t=encodeURIComponent;this.debug&&console.log("send",e);try{var r=new XMLHttpRequest;r.open("POST",this.server,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send("data=".concat(t(e.join()),"&time=").concat((new Date).getTime()))}catch(r){try{(new Image).src="".concat(this.server,"?data=").concat(t(e.join()),"&time=").concat((new Date).getTime())}catch(e){this._warn("通过 IMG 上报失败.",e)}}}},{key:"bridgeLog",value:function(e){window.AlipayJSBridge?window.AlipayJSBridge.call("handleLoggingAction",{actionType:"reportEvent",params:{eventId:this.eventId,bizType:"bmmonitor",extData:e||{}}}):this._warn("非容器环境，不能调用 handleLoggingAction")}}]),e}(),monitorConfigCacheKey="_YUYAN_COOKIE_monitor_config",expireDelta=9e5,ConfigStorage=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getStorageInfoMap",value:function(){try{var e=window.localStorage;if(!e)return{};var t=e.getItem(monitorConfigCacheKey)||"{}";return JSON.parse(t)}catch(e){console&&console.warn&&console.warn("[MonitorSDK]从Storage中获取配置失败",e)}return{}}},{key:"getMonitorConfig",value:function(e){var t=this.getStorageInfoMap()[e];return!t||(new Date).valueOf()>t.expire?null:t.config}},{key:"saveMonitorConfig",value:function(e,t){var r=window.localStorage;if(!r)return null;var n=this.getStorageInfoMap();n[e]={config:t,expire:(new Date).valueOf()+expireDelta},r.setItem(monitorConfigCacheKey,JSON.stringify(n))}}]),e}(),configStorage=new ConfigStorage;function execScript(Monitor,configScript){var window={Tracert:Monitor};return eval(configScript),window}var ServerConfig=function(){function e(){_classCallCheck(this,e),this.monitorConfigInited=!1,this.monitorConfigFailed=!1,this.monitorOptions=[]}return _createClass(e,[{key:"fetchConfig",value:function(){var e=this;if(this.bmAppid){var t=configStorage.getMonitorConfig(this.bmAppid);if(t)this.setMonitorConfigs(t);else{var r="https://render.alipay.com/p/alertserver".concat("pre"===this.userConfig.env?"_pre":"","/").concat(this.bmAppid,"_config/index.js");window.AlipayJSBridge?this.fetchConfigByJSBridge(r):this.fetchConfigByRequest(r)}}else setTimeout((function(){e.onFetchConfigError("没有 bmAppid")}))}},{key:"fetchConfigByRequest",value:function(e){var t=this;window.XMLHttpRequest||this.onFetchConfigError("没有 XHR，无法请求配置");try{var r=new XMLHttpRequest;r.open("GET",e,!0),r.send(),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||304===r.status)try{execScript(t,r.responseText)}catch(e){t.onFetchConfigError(e)}else t.onFetchConfigError("获取配置失败: ".concat(e))}}catch(e){this.onFetchConfigError(e)}}},{key:"initMonitorConfigs",value:function(e){this.setMonitorConfigs(e),configStorage.saveMonitorConfig(this.bmAppid,e)}},{key:"setMonitorConfigs",value:function(e){this.monitorOptions=e.monitors,this.monitorConfigInited=!0,this.onMonitorConfigInited()}},{key:"fetchConfigByJSBridge",value:function(e){var t=this;window.AlipayJSBridge.call("httpRequest",{url:e,method:"GET",contentType:"application/json"},(function(e){if(e&&200===e.status)try{execScript(t,e.data),setTimeout((function(){t.monitorConfigInited||t.onFetchConfigError("获取服务端配置超时")}),3e3)}catch(e){t.onFetchConfigError(e)}else t.onFetchConfigError("未找到配置")}))}}]),e}(),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var lib=createCommonjsModule((function(e){var t,r;t="undefined"!=typeof self?self:commonjsGlobal,r=function(){if("object"==typeof window){var e,t=window,r={0:"navigate",1:"reload",2:"back_forward"},n=["unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart"];return t&&t.performance&&"object"==typeof t.performance?"function"==typeof t.performance.getEntries&&"function"==typeof t.performance.getEntriesByType&&"function"==typeof t.performance.getEntriesByName&&"function"==typeof t.performance.now&&t.performance.timeOrigin?t.performance:e={_entry:function(){for(var e=t.performance.timing,o=e.navigationStart||e.redirectStart||e.fetchStart,i={entryType:"navigation",initiatorType:"navigation",name:t.location.href,startTime:0,duration:e.loadEventEnd?e.loadEventEnd-o:0,redirectCount:t.performance.navigation.redirectCount,type:r[t.performance.navigation.type]},a=0;n.length>a;a++){var s=n[a],c=e[s];i[s]=c?c-o:0}return i}(),timeOrigin:t.performance.timing.navigationStart,getEntries:function(){return[this._entry]},getEntriesByType:function(e){return"navigation"!==e?[]:[this._entry]},getEntriesByName:function(e){return e!==t.location.href?[]:[this._entry]},now:function(){return Date.now()-t.performance.timing.navigationStart}}:e}},e.exports?e.exports=r():t.timing2=r()}));function getWeight(e){return Math.pow(.5,e)}var calculateFMP=function(e){var t=e.records,r=e.start,n=e.timeout,o=e.load;if(0===t.length)return"number"==typeof n?n:0;"number"==typeof o&&t.forEach((function(e){e.weight=getWeight(Math.abs(parseFloat(e.t)-o)/1e3)}));var i=t.map((function(e,r){if(0===r)return 0;var n=t[r-1];return e.domCnt===n.domCnt?0:(e.domCnt-n.domCnt)/(e.t-n.t)*("number"==typeof e.weight?e.weight:1)})),a=Math.max.apply(null,i),s=i.indexOf(a);return t[s].t-r},STACK_LIMIT="number"==typeof __PAINTY_STACK_LIMIT__?__PAINTY_STACK_LIMIT__:100;function now(){return"object"==typeof performance&&"function"==typeof performance.now?performance.now():Date.now()}var _painty_0_3_3_painty=function(e,t){if("object"==typeof window&&"object"==typeof lib){"function"==typeof e&&(t=e);var r=[],n=function e(){if("function"==typeof MutationObserver){var t=new MutationObserver((function(){r.push({t:now(),domCnt:document.getElementsByTagName("*").length}),r.length===STACK_LIMIT&&i()}));return t.observe(document,{childList:!0,subtree:!0}),t.disconnect.bind(t)}var n=setTimeout((function(){r.push({t:now(),domCnt:document.getElementsByTagName("*").length}),r.length===STACK_LIMIT?i():e()}),200);return function(){clearTimeout(n)}}();if("number"==typeof e)setTimeout(i,e);else{var o=!!navigator.userAgent.match(/iPhone|iPad|iPod/i);window.addEventListener(o?"pagehide":"beforeunload",i)}}function i(){if(n(),"object"==typeof lib&&"function"==typeof lib.getEntriesByType){var o=lib.getEntriesByType("navigation");if(o&&o.length){var i=o[0];t(calculateFMP({records:r,start:i.startTime,timeout:e,load:i.duration}))}}}},extractPaintMetrics=function(e){if("object"!==_typeof(e))return[];var t=e.getEntriesByType("paint"),r={};if(t.length){var n=(t.filter((function(e){return"first-paint"===e.name}))[0]||{}).startTime,o=(t.filter((function(e){return"first-contentful-paint"===e.name}))[0]||{}).startTime;r.firstPaint=parseFloat(n),r.firstContentfulPaint=parseFloat(o)}return r};function extractPageMetrics(e,t){if("object"!==_typeof(e)||"function"!=typeof e.getEntriesByType)return null;var r=e.getEntriesByType("navigation");if(!r||0===r.length)return null;var n=r[0],o=extractPaintMetrics(e),i={firstMeaningfulPaint:t};return NAVIGATION_KEYS.reduce((function(e,t){var r=n[t]||o[t]||i[t];return _objectSpread2(_objectSpread2({},e),{},_defineProperty({},"".concat(t),null==r||"number"==typeof r&&isNaN(r)?0:r))}),{})}function getPerformanceMetrics(e,t){return e?normalizeMetrics({m1:t.duration||parseFloat(e.loadEventEnd)-t.startTime,m2:parseFloat(e.domContentLoadedEventStart)-t.startTime,m3:parseFloat(e.domComplete)-t.startTime,m4:e.firstPaint,m5:e.firstContentfulPaint,m6:e.firstMeaningfulPaint,m7:parseFloat(e.redirectEnd)-parseFloat(e.redirectStart),m8:parseFloat(e.domainLookupStart)-parseFloat(e.fetchStart),m9:parseFloat(e.domainLookupEnd)-parseFloat(e.domainLookupStart),m10:parseFloat(e.connectEnd)-parseFloat(e.connectStart),m11:parseFloat(e.connectEnd)-parseFloat(e.secureConnectionStart),m12:parseFloat(e.responseStart)-parseFloat(e.requestStart),m13:parseFloat(e.responseEnd)-parseFloat(e.responseStart),m14:parseFloat(e.domComplete)-parseFloat(e.responseEnd),m15:parseFloat(e.loadEventEnd)-parseFloat(e.responseEnd),m16:parseFloat(e.domInteractive)-t.startTime,m17:parseFloat(e.domContentLoadedEventEnd)-parseFloat(e.domContentLoadedEventStart),m18:parseFloat(e.domComplete)-t.startTime}):{}}function normalizeMetrics(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=isNaN(e[r])?0:Math.round(Math.min(Math.max(0,parseFloat(e[r])),3e5)));return t}var fmp=null,RESOURCE_LIMIT=500,PERFORMANCE_PROJECT_ID="5e85b985a00cad447680db5a",PERFORMANCE_ERROR_CODE=11,SEND_METRICS_ERROR_CODE=12,PERFORMACE_RESERVED_CODE="32767";function logError$1(e,t,r){e.log({bmAppid:PERFORMANCE_PROJECT_ID,code:r,msg:t.message,page:location.href})}function sendMetrics(e,t){if("object"===_typeof(t)&&!e.metricsSent)try{var r,n,o=t.getEntriesByType("navigation")[0],i=extractPageMetrics(t,fmp),a={d1:(null===(r=navigator)||void 0===r||null===(n=r.connection)||void 0===n?void 0:n.effectiveType)||"-",d2:0===o.duration?1:0,d3:document.hidden?0:1},s={c1:document.title};e.log(_objectSpread2(_objectSpread2(_objectSpread2({code:PERFORMACE_RESERVED_CODE,msg:location.href},getPerformanceMetrics(i,o)),a),s)),e.metricsSent=!0}catch(t){logError$1(e,t,SEND_METRICS_ERROR_CODE)}}var Performace=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"apply",value:function(e){if(this.monitor=e,"object"===_typeof(lib))try{_painty_0_3_3_painty((function(e){fmp=e})),"function"==typeof lib.setResourceTimingBufferSize&&lib.setResourceTimingBufferSize(RESOURCE_LIMIT);var t=!!navigator.userAgent.match(/iPhone|iPad|iPod/i);window.addEventListener(t?"pagehide":"beforeunload",sendMetrics.bind(null,e,lib))}catch(t){logError$1(e,t,PERFORMANCE_ERROR_CODE)}}}]),e}(),TracertHacker=function(){function e(){var t=this;_classCallCheck(this,e),this.injectedLog=function(e){var r;return null===(r=t.monitor)||void 0===r?void 0:r.log.call(t.monitor,e)}}return _createClass(e,[{key:"apply",value:function(e){var t=this;this.monitor=e,load((function(){var r=window.Tracert;if(r){var n={log:function(n){var o=(null==n?void 0:n.bmAppId)||(null==n?void 0:n.bm_appid)||n._bmAppId,i=r._bmAppId;return e._warn('"Tracert.log" 已不建议使用。请迁移到 @alipay/yuyan-monitor-web。'),t.injectedLog(_objectSpread2(_objectSpread2({},n),{},{bmAppid:o||i}))}};r.call("after","start",(function(){r.call("set",_objectSpread2({},n))})),r.call("set",_objectSpread2({},n))}}))}}]),e}(),iframeSrc="https://tracert.alipay.com/cross.html",CrossIframe=function(){function e(){_classCallCheck(this,e),this._iframe=null}return _createClass(e,[{key:"canLoadIframe",value:function(){var e=window;return void 0===e.WeixinJSBridge&&void 0===e.QQJSBridge&&(!e.navigator||!(e.navigator.userAgent.toLowerCase().indexOf("micromessenger")>-1||e.navigator.userAgent.toLowerCase().indexOf("qq")>-1||e.navigator.userAgent.toLowerCase().indexOf("toutiaomicroapp")>-1||void 0!==e.navigator.wxuserAgent))}},{key:"initIframe",value:function(){if(!this.canLoadIframe())return null;if(this._iframe)return this._iframe;var e=document.createElement("iframe");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.left="-100px",e.style.bottom="-100px",e.style.width="-100px",e.setAttribute("src",iframeSrc),e.onload=function(){e.style.display="none"};try{document.body.appendChild(e)}catch(e){}return this._iframe=e,e}}]),e}(),crossIframe=new CrossIframe,bucUserKey="_YUYAN_COOKIE_bucUserId";function send(e,t,r){e.postMessage(JSON.stringify({type:t,content:r}),"*")}var BucUserId=function(){function e(){_classCallCheck(this,e),this.iframe=null,this.iframeLoaded=!1,this.pending=!1,this.queue=[],this.cachedQuery=[]}return _createClass(e,[{key:"apply",value:function(e){var t=this;this.monitor=e,load((function(){var e,r;(null===(e=t.monitor)||void 0===e||null===(r=e.userConfig)||void 0===r?void 0:r.userId)||(window.addEventListener("message",(function(e){return t.receive(e)}),!1),t.pending=!0,t.iframe=crossIframe.initIframe(),t.getUserIdForMonitor((function(e){var r,n,o;e&&!(null===(r=t.monitor)||void 0===r||null===(n=r.userConfig)||void 0===n?void 0:n.userId)&&(null===(o=t.monitor)||void 0===o||o.config({userId:e}))})))}))}},{key:"getUserIdForMonitor",value:function(e){var t=this,r=window.localStorage;if(r){var n,o=r.getItem(bucUserKey);if(o)return e(o),void(null===(n=this.monitor)||void 0===n||n._warn("从 localstorge 中获取 bucId:",o))}this.getBucUserId((function(){var n=t.userId;r&&n&&r.setItem(bucUserKey,n),e(t.userId||"")}))}},{key:"receive",value:function(e){var t,r;if(e.data){try{r=JSON.parse(e.data)}catch(e){return}if(r.type)switch(r.type){case"getBucUserId":for(this.userId=r.content,this.pending=!1,null===(t=this.monitor)||void 0===t||t._warn("从跨域 storage 获取 bucId:",this.userId);this.queue.length;){(0,this.queue[0])(r.content),this.queue.shift()}break;case"iframOnload":this.iframeOnLoad()}}}},{key:"iframeOnLoad",value:function(){this.iframeLoaded=!0,this.executeCachedQuery()}},{key:"executeCachedQuery",value:function(){if(this.cachedQuery.length)for(var e=0;this.cachedQuery.length>e;e++){var t=_toArray(this.cachedQuery[e]),r=t[0],n=t.slice(1);this[r].apply(this,n)}}},{key:"getBucUserId",value:function(e){this.iframeLoaded?(this.queue.push(e),this.pending||(send(this.iframe.contentWindow,"getBucUserId"),this.pending=!0)):this.cachedQuery.push(["getBucUserId",e])}}]),e}(),hashMap={};function detectHash(e){return _detectHash.apply(this,arguments)}function _detectHash(){return(_detectHash=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!hashMap[t]){e.next=2;break}return e.abrupt("return",Promise.resolve(!0));case 2:return e.abrupt("return",new Promise((function(e,r){try{var n=new XMLHttpRequest;n.open("GET","https://dataservice.alipayobjects.com/alertserver/hash/".concat(t),!0),n.send(),n.onreadystatechange=function(){if(4===n.readyState)return 200===n.status||304===n.status?(hashMap[t]=!0,e(!0)):e(!1)}}catch(e){return r(e)}})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ErrorCodeEnums$2=enums.ErrorCodeEnums,win$1=window,MonitorWeb=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{appType:"H5"};return _classCallCheck(this,r),(e=t.call(this,n)).jsBridgeReady=!1,e.itemCache=[],e.monitorOptionMap={},e.UserConfig={},e.monitorConfigInited=!1,e.monitorConfigFailed=!1,e.monitorOptions=[],(new TracertHacker).apply(_assertThisInitialized(e)),-1!==e.enabledPlugins.indexOf("performance")&&(new Performace).apply(_assertThisInitialized(e)),-1!==e.enabledPlugins.indexOf("buc")&&(new BucUserId).apply(_assertThisInitialized(e)),e.isAlipay=checkIsAlipay(win$1.navigator),e.initJsBridge(),e.fetchConfig(),e.handlePreCapture(),e.register(),e}return _createClass(r,[{key:"log",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(e){var r=this.isAlipay&&!this.jsBridgeReady;!r&&this.monitorConfigInited&&allFieldsReady(this.userConfig,this.requiredFields,this._warn.bind(this))?this._log(e,t):this.itemCache.push([e,t])}}},{key:"logError",value:function(e,t){logError(e,detectHash,{log:this.log.bind(this),_warn:this._warn.bind(this)},t)}},{key:"logRequestError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!e)return;var t=e.type,r=void 0===t?"http":t;if("http"===r){var n=e.status,o=e.url,i=e.method,a=e.query,s=e.data,c=e.response,u=e.traceId,f=e.code,l="".concat(i.toUpperCase()," ").concat(o),d={code:f||2,msg:l};n&&(d.s1=n),a&&(d.s2=a),s&&(d.s3=s),c&&(d.s4=c),u&&(d.s5=u),this.log(d)}}catch(e){this._warn("接口异常上报失败:",e)}}},{key:"config",value:function(e){e&&"object"===_typeof(e)&&(shallowMerge(this.userConfig,e),allFieldsReady(this.userConfig,this.requiredFields,this._warn.bind(this))&&this.logCache())}},{key:"logCache",value:function(){for(var e=this.itemCache,t=0;e.length>t;t++){var r=e[t];Array.isArray(r)&&this._log(r[0],r[1])}this.itemCache=[]}},{key:"preprocess",value:function(e){var t;if("function"==typeof this.beforeLog)try{e=this.beforeLog(e)}catch(e){this._warn("beforeLog 失败:",e)}if(!e||"object"!==_typeof(e)&&Array.isArray(e))this._warn("beforeLog返回值不是对象，不进行上报");else{for(var r=generateIdentifier(_objectSpread2(_objectSpread2({},e),{},{uid:e.roleId||this.userConfig.userId||this.cUserId||"",page:location.href})),n=!1,o=0;this.trackedLogs.length>o;o++)if(this.trackedLogs[o]===r){n=!0;break}if(!(null!==(t=e.oncePerSession)&&void 0!==t?t:this.oncePerSession)||!n){if((e.bmAppid||this.bmAppid)===this.bmAppid){if(e.code===PERFORMACE_RESERVED_CODE)return e;var i=this.monitorOptionMap[Number(e.code)]||this.monitorOptionMap["".concat(e.code)];if(!this.monitorConfigFailed&&!i)return void this._warn("监控平台没有该监控项的配置，code: ".concat(e.code));var a=i&&i.sampleRate||e.sampleRate||1;if(Math.random()>a)return void this._warn("当前已设置采样率 ".concat(a,"，未被采集"));if(i){for(var s={},c=i.fields||[],u=0;c.length>u;u++)s[c[u]]=!0;for(var f in e)!s[f]&&/^[dmc]\d+$/.test(f)&&delete e[f]}}return!n&&this.trackedLogs.push(r),e}this._warn("当前由于 OncePerSession 策略，未被采集")}}},{key:"_log",value:function(e,t){var r=this.preprocess(e);if(r){this.getSpmInfo();var n=this.parseParam4(r);if(!!(null==t?void 0:t.forceHttpReport)||!this.isBridgeReport(n.code)){var o=r.roleId||this.userConfig.userId||this.cUserId||"";delete r.roleId;var i=navigator.userAgent?navigator.userAgent.replace(/,/g,"%2C"):"",a=parseItem({eventId:this.eventId,userId:o,param4:n,ua:i});if(!a.length)return;return this.sendData(a)}n._ua=navigator.userAgent?navigator.userAgent.replace(/,/g,"%2C"):"";for(var s=0,c=Object.keys(n);c.length>s;s++){var u=c[s];n[u]=encodeValue(n[u])}this.bridgeLog(n)}}},{key:"getSpmInfo",value:function(){var e=window._to||{};if(!this.userConfig.spmAPos){var t=getMetaSpm().spmAPos||e.spmAPos;t&&(this.userConfig.spmAPos=t)}if(!this.userConfig.spmBPos){var r=getSpmBPos()||e.spmBPos;r&&(this.userConfig.spmBPos=r)}}},{key:"initJsBridge",value:function(){var e=this;document.addEventListener("AlipayJSBridgeReady",(function(){e.onJsBridgeReady()}))}},{key:"getInfoFromBridge",value:function(e){var t=this,r=2;function n(){0===--r&&e()}try{var o=win$1.AlipayJSBridge;o.call("getUserInfo",(function(e){t.cUserId=e.userId,n()})),o.call("getStartupParams",(function(e){t.cOfflineVer=e.version,e.version&&(t.cAppId=e.appId),n()}))}catch(t){e(),this._warn("调用容器接口获取信息失败",t)}}},{key:"onJsBridgeReady",value:function(){var e=this;this.getInfoFromBridge((function(){e.jsBridgeReady=!0,e.monitorConfigInited&&e.logCache()}))}},{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};objectAssign$1(this,e)}},{key:"setMonitorConfigs",value:function(){}},{key:"initMonitorConfigs",value:function(){}},{key:"fetchConfig",value:function(){}},{key:"fetchConfigByRequest",value:function(){}},{key:"fetchConfigByJSBridge",value:function(){}},{key:"onMonitorConfigInited",value:function(){var e=this;this.monitorOptions&&this.monitorOptions.forEach((function(t){t&&t.code&&(e.monitorOptionMap[t.code]=t)}));var t=this.monitorOptionMap[ErrorCodeEnums$2.REQUEST];!this.disableInterface&&t&&(t.code===ErrorCodeEnums$2.REQUEST&&t.isActive&&!t.isDeleted&&interfaceRegister(this));this.isAlipay&&!this.jsBridgeReady||this.logCache()}},{key:"onFetchConfigError",value:function(e){this.monitorConfigInited=!0,this.monitorConfigFailed=!0,this.onMonitorConfigInited(),this._warn("获取服务端配置失败：",e)}}]),r}(Base);return applyMixins(MonitorWeb,[ServerConfig]),MonitorWeb}));
